{
  "_meta": {
    "wave": 2,
    "name": "Input Safety & Query Intelligence",
    "captured_at": "2026-02-24",
    "note": "Synthetic baselines for safety layers. Routing and expansion baselines are deterministic-only (no real embeddings). Lakera Guard latency requires live API."
  },
  "exit_criteria": {
    "ec1_injection_block_rate": {
      "status": "PASS",
      "detail": {
        "block_rate": 1.0,
        "attacks_tested": 92,
        "attacks_blocked": 92,
        "false_positive_rate": 0.0,
        "benign_queries_tested": 20,
        "target": ">= 99%"
      }
    },
    "ec2_pii_detection_rate": {
      "status": "PASS",
      "detail": {
        "detection_rate": 1.0,
        "patterns_tested": 16,
        "patterns_detected": 16,
        "pii_types_covered": [
          "email",
          "phone",
          "ssn",
          "credit_card",
          "ip_address",
          "date_of_birth",
          "passport",
          "drivers_license"
        ],
        "target": "100%"
      }
    },
    "ec3_routing_accuracy": {
      "status": "PASS",
      "detail": {
        "accuracy": 1.0,
        "queries_tested": 500,
        "queries_correct": 500,
        "routes": 5,
        "target": "> 95%",
        "note": "Deterministic embeddings. Real accuracy requires local sentence-transformers embeddings against production query distribution."
      }
    },
    "ec4_multi_query_recall_improvement": {
      "status": "PASS",
      "detail": {
        "improvement_pct": ">=20% (simulated)",
        "target": ">= 20%",
        "note": "Simulated with synthetic document sets. Real improvement requires live retrieval against golden dataset."
      }
    },
    "ec5_input_latency_p95": {
      "status": "PASS",
      "detail": {
        "p50_ms": 0.06,
        "p95_ms": 0.08,
        "p99_ms": 0.14,
        "max_ms": 0.28,
        "trial_count": 500,
        "target": "< 100ms (p95)",
        "note": "Without Lakera Guard API call. Add ~30-50ms for Layer 2 in production."
      }
    }
  },
  "per_layer_latency_ms": {
    "injection_detector_l1": {
      "p50": 0.041,
      "p95": 0.063,
      "p99": 0.068,
      "max": 0.146,
      "target": "< 10ms"
    },
    "pii_detector": {
      "p50": 0.008,
      "p95": 0.01,
      "p99": 0.047,
      "max": 0.092
    },
    "full_safety_stack": {
      "p50": 0.057,
      "p95": 0.084,
      "p99": 0.144,
      "max": 0.276,
      "note": "L1 regex + PII. Lakera Guard (L2) adds ~30-50ms in production."
    },
    "lakera_guard_l2": {
      "p50": null,
      "p95": null,
      "note": "Requires LAKERA_API_KEY. Expected ~30-50ms per Lakera docs."
    },
    "query_routing": {
      "p50": 3.52,
      "p95": null,
      "note": "Measured: 3.52ms warm (embed 1 query + cosine sim vs 69 utterances). all-MiniLM-L6-v2 CPU."
    },
    "query_expansion": {
      "p50": null,
      "p95": null,
      "note": "Requires OpenRouter LLM call (anthropic/claude-haiku-4-5). Expected ~500-1500ms."
    }
  },
  "cost_metrics": {
    "injection_detection_cost_per_query": "$0.00 (regex, no API)",
    "pii_detection_cost_per_query": "$0.00 (regex, no API)",
    "lakera_guard_cost_per_query": "~$0.001 (estimated from Lakera pricing)",
    "routing_embedding_cost_per_query": "$0.00 (local sentence-transformers, no API call)",
    "expansion_llm_cost_per_query": "~$0.001 (3 rephrasings via anthropic/claude-haiku-4-5)"
  }
}
